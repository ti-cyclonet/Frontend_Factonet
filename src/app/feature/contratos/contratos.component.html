<div class="floating-container">
  <div class="outer-container">
    <!-- Título -->
    <div class="inner-container">
      <h3 class="card-title mb-0 fw-bold">Contracts List</h3>
    </div>
    
    <!-- Tabla de contratos -->
    <div class="inner-container">
      <div class="table-responsive">
        <table class="table table-striped">
          <thead>
            <tr>
              <th class="d-none d-md-table-cell">Code</th>
              <th>User</th>
              <th class="d-none d-md-table-cell">Package</th>
              <th class="d-none d-md-table-cell">Value</th>
              <th class="d-none d-md-table-cell">Pay Day</th>
              <th class="d-none d-md-table-cell">Start Date</th>
              <th class="d-none d-md-table-cell">End Date</th>
              <th class="d-md-none">Status</th>
              <th class="d-none d-md-table-cell">Status</th>
              <th class="text-center" style="width: 100px;">Actions</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let contrato of contratos(); trackBy: trackById" 
                [class.selected]="selectedContrato() === contrato"
                (click)="setSelectedContrato(contrato)">
              <td class="d-none d-md-table-cell"><strong>{{ contrato.code || contrato.id }}</strong></td>
              <td>{{ contrato.user.strUserName || 'N/A' }}</td>
              <td class="d-none d-md-table-cell">{{ contrato.package.name || 'N/A' }}</td>
              <td class="d-none d-md-table-cell">$ {{ ((+contrato.value || 0) | number:'1.0-0' || '0') | replace:',':'.' }},oo</td>
              <td class="d-none d-md-table-cell">{{ contrato.payday }}</td>
              <td class="d-none d-md-table-cell">{{ contrato.startDate }}</td>
              <td class="d-none d-md-table-cell">{{ contrato.endDate }}</td>
              <td class="d-md-none">
                <span class="badge" [ngClass]="{
                  'bg-success': contrato.status === 'ACTIVE',
                  'bg-danger': contrato.status === 'EXPIRED',
                  'bg-warning': contrato.status === 'PENDING'
                }">{{ contrato.status }}</span>
              </td>
              <td class="d-none d-md-table-cell">
                <span class="badge" [ngClass]="{
                  'bg-success': contrato.status === 'ACTIVE',
                  'bg-danger': contrato.status === 'EXPIRED',
                  'bg-warning': contrato.status === 'PENDING'
                }">{{ contrato.status }}</span>
              </td>
              <td>
                <div class="d-flex align-items-center justify-content-center gap-2">
                  <button type="button" class="btn-icon" (click)="viewContrato(contrato)" title="Ver detalles">
                    <svg width="16" height="16" fill="currentColor" class="text-primary">
                      <use xlink:href="./assets/icons/bootstrap-icons.svg#eye" />
                    </svg>
                  </button>
                  <button type="button" class="btn-icon" (click)="openDeleteConfirmationModal()" title="Eliminar">
                    <svg width="16" height="16" fill="currentColor" class="text-danger">
                      <use xlink:href="./assets/icons/bootstrap-icons.svg#trash" />
                    </svg>
                  </button>
                </div>
              </td>
            </tr>
            <tr *ngIf="contratos().length === 0">
              <td colspan="3" class="text-center d-md-none">No hay contratos disponibles</td>
              <td colspan="10" class="text-center d-none d-md-table-cell">No hay contratos disponibles</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>

<!-- Modal para ver detalles del contrato -->
<div class="modal fade" id="viewContractModal" tabindex="-1" aria-labelledby="viewContractModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content border-0 shadow-lg">
      <div class="modal-body p-0">
        <div class="contract-card-modal" *ngIf="modalContrato">
          <!-- Header con código y estado -->
          <div class="contract-header" [ngClass]="{
            'bg-warning': modalContrato.status === 'PENDING',
            'bg-success': modalContrato.status === 'ACTIVE',
            'bg-danger': modalContrato.status === 'EXPIRED'
          }">
            <h4 class="contract-code text-dark fw-bold mb-0">{{ modalContrato.code || modalContrato.id }}</h4>
            <span class="status-badge bg-white text-dark">{{ modalContrato.status }}</span>
          </div>

          <!-- Contenido del contrato -->
          <div class="contract-body">
            <!-- Usuario -->
            <div class="info-section">
              <label class="info-label">Usuario</label>
              <div class="info-value user-clickable" [class.user-active]="showUserDetails()" (click)="toggleUserDetails()">{{ modalContrato.user.strUserName || 'N/A' }}</div>
            </div>

            <!-- Información del usuario -->
            <div class="user-info-section mb-4" *ngIf="modalContrato.user.basicData && showUserDetails()">
              <!-- Persona Jurídica -->
              <div *ngIf="modalContrato.user.basicData.strPersonType === 'J' && modalContrato.user.basicData.legalEntityData" class="p-3 rounded" style="background-color: #ffe6e6;">
                <h6 class="fw-bold mb-2">{{ modalContrato.user.basicData.legalEntityData.businessName }}</h6>
                <div>
                  <div class="mb-1">
                    <small class="text-muted">Contacto:</small> {{ modalContrato.user.basicData.legalEntityData.contactName }}
                  </div>
                  <div class="mb-1">
                    <small class="text-muted">Email:</small> {{ modalContrato.user.basicData.legalEntityData.contactEmail }}
                  </div>
                  <div class="mb-1">
                    <small class="text-muted">Teléfono:</small> {{ modalContrato.user.basicData.legalEntityData.contactPhone }}
                  </div>
                  <div *ngIf="modalContrato.user.basicData.legalEntityData.webSite">
                    <small class="text-muted">Web:</small> {{ modalContrato.user.basicData.legalEntityData.webSite }}
                  </div>
                </div>
              </div>
              <!-- Persona Natural -->
              <div *ngIf="modalContrato.user.basicData.strPersonType === 'N' && modalContrato.user.basicData.naturalPersonData" class="p-3 rounded" style="background-color: #ffe6e6;">
                <h6 class="fw-bold mb-2">{{ modalContrato.user.basicData.naturalPersonData.firstName }} {{ modalContrato.user.basicData.naturalPersonData.firstSurname }}</h6>
                <div>
                  <div class="mb-1">
                    <small class="text-muted">Fecha de nacimiento:</small> {{ modalContrato.user.basicData.naturalPersonData.birthDate | date:'dd/MM/yyyy' }}
                  </div>
                  <div>
                    <small class="text-muted">Estado civil:</small> {{ modalContrato.user.basicData.naturalPersonData.maritalStatus }}
                  </div>
                </div>
              </div>
            </div>

            <!-- Paquete -->
            <div class="info-section">
              <label class="info-label">Paquete</label>
              <div class="info-value user-clickable" [class.user-active]="showPackageDetails()" (click)="togglePackageDetails()">{{ modalContrato.package.name || 'N/A' }}</div>
              <div class="info-description" *ngIf="showPackageDetails()" style="background-color: #ffe6e6; padding: 10px; border-radius: 5px; margin-top: 10px;">
                <div class="mb-1"><small class="text-muted">Código:</small> {{ modalContrato.package.code }}</div>
                <div class="mb-2"><small class="text-muted">Descripción:</small> {{ modalContrato.package.description || 'Sin descripción' }}</div>
                <div *ngIf="modalContrato.package.configurations && modalContrato.package.configurations.length > 0">
                  <div class="mb-1"><small class="text-muted fw-bold">Configuraciones:</small></div>
                  <div *ngFor="let config of modalContrato.package.configurations" class="ms-2 mb-1">
                    <small>• <strong>{{ config.totalAccount }}</strong> cuentas <strong>{{ config.rol.strName }}</strong> - <strong>${{ config.price | number:'1.0-0' }}</strong> c/u</small>
                  </div>
                </div>
              </div>
            </div>

            <!-- Modalidad -->
            <div class="info-section">
              <label class="info-label">Modalidad</label>
              <div class="info-value">{{ modalContrato.mode || 'N/A' }}</div>
            </div>

            <!-- Valor y día de pago -->
            <div class="row g-3 mb-4">
              <div class="col-6">
                <div class="value-box text-center">
                  <div class="value-amount text-success fw-bold">${{ ((+(modalContrato.value || 0)) | number:'1.0-0' || '0') | replace:',':'.' }},oo</div>
                  <div class="value-label">Valor</div>
                </div>
              </div>
              <div class="col-6">
                <div class="value-box text-center">
                  <div class="value-amount text-primary fw-bold">{{ modalContrato.payday }}</div>
                  <div class="value-label">Día de pago</div>
                </div>
              </div>
            </div>

            <!-- Fechas -->
            <div class="row g-3 mb-4">
              <div class="col-6">
                <div class="date-section">
                  <label class="date-label">Inicio</label>
                  <div class="date-value">{{ modalContrato.startDate | date:'dd/MM/yyyy' }}</div>
                </div>
              </div>
              <div class="col-6">
                <div class="date-section">
                  <label class="date-label">Fin</label>
                  <div class="date-value">{{ modalContrato.endDate | date:'dd/MM/yyyy' }}</div>
                </div>
              </div>
            </div>

            <!-- Botón de acción -->
            <hr class="my-3">
            <div class="action-buttons">
              <button type="button" class="btn btn-primary" data-bs-dismiss="modal">Aceptar</button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>