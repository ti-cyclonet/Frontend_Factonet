<!-- CONTENEDORES DE NOTIFICACIONES (Se mantienen flotantes, pero con tema oscuro) -->
<!-- Contenedor flotante (derecha) - container 0 (Toast) -->
<div class="fixed top-4 right-4 z-50 notification-container max-w-sm">
  <ng-container *ngFor="let notification of notifications; let i = index">
    <app-notifications
      *ngIf="notification.container === 0 && notification.visible"
      [title]="notification.title"
      [type]="notification.type"
      [alertType]="notification.alertType"
      (close)="removeNotification(i)"
      class="bg-gray-800 text-white"
    ></app-notifications>
  </ng-container>
</div>

<!-- Contenedor superior (todo el ancho) - container 1 (Alert) -->
<div class="notification-full-width-container w-full">
  <ng-container *ngFor="let notification of notifications; let i = index">
    <app-notifications
      *ngIf="notification.container === 1 && notification.visible"
      [title]="notification.title"
      [type]="notification.type"
      [alertType]="notification.alertType"
      (close)="removeNotification(i)"
      class="mx-4 md:mx-8 lg:mx-12 mt-4"
    ></app-notifications>
  </ng-container>
</div>


<!-- VISTA PRINCIPAL DE FACTURAS -->
<div class="min-h-screen bg-gray-900 matrix-background p-4 md:p-8 lg:p-10">
  
  <div class="max-w-7xl mx-auto">

    <!-- Encabezado de la página (Título y Botones de Acción) -->
    <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-6 border-b border-green-700/50 pb-4">
      <h1 class="text-3xl font-extrabold text-green-400 mb-2 sm:mb-0 matrix-title">
        REGISTROS DE FACTURACIÓN
      </h1>
      
      <!-- Botones de Acción: ADD, EDITAR, DELETE -->
      <div class="flex space-x-3 mt-3 sm:mt-0">
          <!-- ADD (verde/cyan) -->
          <button 
            (click)="openFacturaModal()"
            class="matrix-btn add-btn flex items-center"
            aria-label="Añadir nuevo registro"
          >
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-1" viewBox="0 0 20 20" fill="currentColor">
              <path fill-rule="evenodd" d="M10 5a1 1 0 011 1v3h3a1 1 0 110 2h-3v3a1 1 0 11-2 0v-3H6a1 1 0 110-2h3V6a1 1 0 011-1z" clip-rule="evenodd" />
            </svg>
            ADD
          </button>
          
          <!-- EDITAR (Naranja/Marrón) - Habilitado si hay factura seleccionada -->
          <button 
            [disabled]="!selectedFactura"
            (click)="showToast('Editando ' + selectedFactura?.numero, 'warning', 'A', 0)"
            class="matrix-btn edit-btn flex items-center"
            [ngClass]="{'opacity-50 cursor-not-allowed': !selectedFactura}"
            aria-label="Editar registro seleccionado"
          >
            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1" viewBox="0 0 20 20" fill="currentColor">
              <path d="M17.414 2.586a2 2 0 00-2.828 0L7 10.172V13h2.828l7.586-7.586a2 2 0 000-2.828z" />
              <path fill-rule="evenodd" d="M2 6a2 2 0 012-2h4a1 1 0 010 2H4v10h10v-4a1 1 0 112 0v4a2 2 0 01-2 2H4a2 2 0 01-2-2V6z" clip-rule="evenodd" />
            </svg>
            EDITAR
          </button>

          <!-- DELETE (Rojo/Borgoña) - Habilitado si hay factura seleccionada -->
          <button 
            [disabled]="!selectedFactura"
            (click)="confirmDeleteFactura()"
            class="matrix-btn delete-btn flex items-center"
            [ngClass]="{'opacity-50 cursor-not-allowed': !selectedFactura}"
            aria-label="Eliminar registro seleccionado"
          >
            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1" viewBox="0 0 20 20" fill="currentColor">
              <path fill-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z" clip-rule="evenodd" />
            </svg>
            DELETE
          </button>
      </div>
    </div>
    
    <!-- Contenedor Principal de la Tabla con estilo Matrix -->
    <div class="matrix-card rounded-md overflow-hidden">
      
      <!-- Tabla de Facturas Responsive -->
      <div class="overflow-x-auto">
        <table class="min-w-full divide-y-0 matrix-table">
          
          <!-- Encabezados de la Tabla -->
          <thead class="bg-black/50 matrix-header">
            <tr>
              <th scope="col" class="px-6 py-3 text-left text-xs font-semibold uppercase tracking-wider text-green-400">
                SEL.
              </th>
              <th scope="col" class="px-6 py-3 text-left text-xs font-semibold uppercase tracking-wider text-green-400">
                ID TRANS.
              </th>
              <th scope="col" class="px-6 py-3 text-left text-xs font-semibold uppercase tracking-wider text-green-400">
                ENTIDAD CLIENTE
              </th>
              <th scope="col" class="px-6 py-3 text-right text-xs font-semibold uppercase tracking-wider text-green-400">
                MONTO (USD)
              </th>
              <th scope="col" class="px-6 py-3 text-center text-xs font-semibold uppercase tracking-wider text-green-400">
                ESTADO PAGO
              </th>
            </tr>
          </thead>
          
          <!-- Cuerpo de la Tabla -->
          <tbody class="divide-y-0">
            <tr 
              *ngFor="let factura of facturas; trackBy: trackById" 
              (click)="setSelectedFactura(factura)"
              [ngClass]="{'selected-row': selectedFactura === factura, 'hover:bg-green-900/10': selectedFactura !== factura}"
              class="transition duration-150 cursor-pointer matrix-row"
            >
              <!-- Selector (Checkbox visual) -->
              <td class="px-6 py-3 whitespace-nowrap text-sm text-center">
                  <div class="matrix-checkbox" [ngClass]="{'checked': selectedFactura === factura}"></div>
              </td>
              <!-- ID Trans. / Número -->
              <td class="px-6 py-3 whitespace-nowrap text-sm font-medium text-green-400">
                {{ factura.numero }}
              </td>
              <!-- Entidad Cliente -->
              <td class="px-6 py-3 whitespace-nowrap text-sm text-gray-200">
                {{ factura.cliente | uppercase }}
              </td>
              <!-- Total (Monto USD) -->
              <td class="px-6 py-3 whitespace-nowrap text-sm font-bold text-green-300 text-right">
                {{ factura.total | currency:'USD':'symbol':'1.2-2' }}
              </td>
              <!-- Estado Pago (Badge) -->
              <td class="px-6 py-3 whitespace-nowrap text-center">
                <span 
                  class="px-3 py-1 inline-flex text-xs leading-5 font-bold rounded matrix-badge"
                  [ngClass]="getStatusClass(factura.estado)"
                >
                  {{ factura.estado | uppercase }}
                </span>
              </td>
            </tr>

            <!-- Fila de ejemplo si no hay facturas -->
            <tr *ngIf="facturas.length === 0">
              <td colspan="5" class="px-6 py-10 text-center text-gray-500 bg-gray-900/50">
                NO HAY REGISTROS ENCONTRADOS.
              </td>
            </tr>
          </tbody>
        </table>
      </div>

    </div>
  </div>
</div>
