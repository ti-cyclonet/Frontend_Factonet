<div class="header-wrapper">
    <div class="header-content-wrapper">
        <!-- CUADRO NEGRO CON LOGO Y USUARIO -->
        <div class="header-container d-flex justify-content-between align-items-center">
        <div class="d-flex align-items-center flex-fill"> 
            <a href="#" class="logo-container">
                <img src="./assets/img/logo_factonet_v3.png" alt="Logo" class="logo-img" />
            </a>
        </div>
        
        <!-- DESCRIPCIÓN DEL MENÚ SELECCIONADO -->
        <div class="position-absolute w-100 d-none d-md-flex justify-content-center" style="left: -30px;">
            <span class="selected-menu-description">{{ getSelectedMenuDescription() }}</span>
        </div>

        <!-- BOTONES USUARIO + CAMPANITA -->
<div class="d-flex align-items-center ms-auto">

    <!-- CAMPANITA DE NOTIFICACIONES SOLO MOBILE (solo facturas pendientes) -->
    <div *ngIf="isMobile && pendingInvoices > 0" class="position-relative me-3 notification-container">
        <a href="#" 
        class="nav-tool-btn notification-bell" 
        (click)="toggleDropdown(); $event.preventDefault()">
            <svg width="24" height="24" fill="currentColor" viewBox="0 0 16 16">
                <use xlink:href="./assets/icons/bootstrap-icons.svg#bell-fill" />
            </svg>
            <span class="badge bg-primary rounded-pill position-absolute top-0 start-100 translate-middle">
                {{ pendingInvoices }}
            </span>
        </a>

        <!-- LISTADO DE NOTIFICACIONES -->
        <ul *ngIf="dropdownOpen"
    class="dropdown-menu show p-2 mt-2 dropdown-menu-end notifications-menu"
    (click)="$event.stopPropagation()"
    style="right:0; z-index:1050; width:260px;">
    
    <!-- Facturas pendientes en móvil -->
    <li *ngIf="isMobile && pendingInvoices > 0" class="notification-item">
        <span class="text-dark">
            <span class="badge me-2 bg-warning text-dark">
                {{ pendingInvoices }}
            </span>
            Pending invoices
        </span>
    </li>
</ul>


    </div>

    <!-- NOMBRE Y ROL DEL USUARIO (SOLO EN DESKTOP Y SIN NOTIFICACIONES) -->
    <div *ngIf="!(isMobile && pendingInvoices > 0)" class="text-end me-3 d-none d-sm-block user-info-frame">
        <div class="user-name">{{ userName }}</div> 
        <div class="user-detail">{{ userRolDescription }}</div>
    </div>

    <!-- AVATAR Y DROPDOWN DE USUARIO -->
    <div class="btn-group position-relative">
        <a
            class="profile-toggle"
            (click)="toggleUserDropdown($event)"
            href="#"
        >
            <img 
                [src]="userImage ? userImage : './assets/img/foto_perfil.png'" 
                alt="Profile Picture" 
                class="user-img rounded-circle" 
                width="40" 
                height="40" 
                onerror="this.onerror=null; this.src='./assets/img/foto_perfil.png';"
            />
        </a>

        <ul class="dropdown-menu p-3 mt-2 dropdown-menu-end" [class.show]="userDropdownOpen" style="z-index: 9999;">
          <li class="d-flex align-items-center">
            <img
              *ngIf="userImage"
              [src]="userImage"
              alt="Foto de usuario"
              class="user-img me-2"
            />
            <div>
              <strong>{{ userName }}</strong>
              <p class="text-muted small mb-0">{{ userRolDescription }}</p>
            </div>
          </li>
          <li><hr class="dropdown-divider" /></li>
          <li>
            <a class="dropdown-item" href="mailto:{{ userEmail }}">
              <svg
                class="dropdown-icon"
                width="16"
                height="16"
                fill="currentColor"
              >
                <use xlink:href="./assets/icons/bootstrap-icons.svg#envelope" />
              </svg>
              {{ userEmail }}
            </a>
          </li>
          <li><hr class="dropdown-divider" /></li>
          <!-- Opciones de menú dinámicas (solo en móvil) -->
          <li *ngFor="let option of optionsMenu; trackBy: trackByOptionId" class="d-block d-md-none">
            <a class="dropdown-item" [routerLink]="option.url" (click)="userDropdownOpen = false">
              <svg
                class="dropdown-icon"
                width="16"
                height="16"
                fill="currentColor"
              >
                <use [attr.xlink:href]="'./assets/icons/bootstrap-icons.svg#' + option.icon" />
              </svg>
              {{ option.description || option.name }}
            </a>
          </li>
          <li class="d-block d-md-none"><hr class="dropdown-divider" /></li>
          <li>
            <a
              class="dropdown-item"
              href="#"
              (click)="openChangePasswordModal(); $event.preventDefault()"
            >
              <svg
                class="dropdown-icon"
                width="16"
                height="16"
                fill="currentColor"
              >
                <use xlink:href="./assets/icons/bootstrap-icons.svg#key" />
              </svg>
              Change password
            </a>
          </li>
          <li><hr class="dropdown-divider" /></li>
          <li>
            <a class="dropdown-item logout-btn" href="#" (click)="logout()">
              <svg width="20" height="20" fill="currentColor">
                <use
                  xlink:href="./assets/icons/bootstrap-icons.svg#box-arrow-right"
                />
              </svg>
              Logout
            </a>
          </li>
        </ul>
    </div>

</div>

        </div>
        
        <!-- NAVBAR CON MENÚS -->
        <app-navbar [optionsMenu]="optionsMenu"></app-navbar>
    </div>
</div>

<!-- Modal de Cambio de Contraseña -->
<div
  class="modal fade"
  id="changePasswordModal"
  tabindex="-1"
  aria-labelledby="staticBackdropLabel"
  aria-hidden="true"
>
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header justify-content-between modal-header-custom">
        <h1 class="modal-title fs-5" id="staticBackdropLabel">
          Password Change Form
        </h1>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <app-change-password></app-change-password>
      </div>
    </div>
  </div>
</div>
